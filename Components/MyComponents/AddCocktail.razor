@namespace MyComponents.AddCocktail
@inject CircleHospitalityContext Context
@rendermode InteractiveServer
@using MyComponents.ItemTypeDropdown
@using MyComponents.IngredientList
@using System
@using System.Linq
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.AspNetCore.Components.Forms

<div class="container text-center">
    <div class="row">
        <div class="col">
            <div class="container text-center">
                <EditForm Model=Context.LocationMenus FormName="MenuItemForm" method="post" OnSubmit="OnPost">
                    
                    <div asp-validation-summary="All" class="text-danger"></div>

                    <div class="row mb-3">
                        <div class="col">
                            <label asp-for="itemName" class="form-label">Name:</label>
                        </div>

                        <div class="col">
                            <InputText @bind-Value=newMenuItem.ItemName />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label for="description" class="form-label">Description:</label>
                        </div>
                        <div class="col">
                             <InputText @bind-Value=newMenuItem.ItemDescription />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label for="creatorName" class="form-label">Creator:</label>
                        </div>
                        <div class="col">
                            <InputText @bind-Value=newMenuItem.CreatorName />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label for="price" class="form-label">Price:</label>
                        </div>
                        <div class="col">
                            <InputNumber @bind-Value="@newLocationMenu.Price" />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Allergens:</label>
                        </div>
                        <div class="col">
                            <div class="container text-center">
                                <div class="row">
                                    <div class="col">
                                        <InputCheckbox @bind-Value="@newLocationMenu.HasDairy" />
                                        <label for="hasDairy" class="form-label ms-2">Has Dairy</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <InputCheckbox @bind-Value="@newLocationMenu.HasEgg" />
                                        <label for="hasEgg" class="form-label ms-2">Has Egg</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Available at:</label>
                        </div>
                        <div class="col">
                            <div class="container text-center">
                                <div class="row">
                                    <div class="col">
                                        <InputCheckbox @bind-Value="@IsAtSVI" />
                                        <label for="IsAtSVI" class="form-label ms-2">Sundry - Indy</label>
                                        @if (IsAtSVI)
                                        {
                                            <p>At SVI</p>
                                        }
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <InputCheckbox @bind-Value="@IsAtSVC" />
                                        <label for="availSVC" class="form-label ms-2">Sundry - Cincy</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <InputCheckbox @bind-Value="@IsAtCS" />
                                        <label for="availCS" class="form-label ms-2">Comfort - Cincy</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Cocktail Type:</label>
                        </div>
                        <div class="col">
                            <InputSelect @bind-Value="@newMenuItem.ItemTypeID">
                                @foreach (var itemType in (from IT in Context.ItemTypes
                                                      select new {IT.ItemTypeID, IT.ItemTypeDescription}))
                                {
                                    <option value=@itemType.ItemTypeID>@itemType.ItemTypeDescription</option>
                                }
                            </InputSelect>
                        </div>
                    </div>
`
                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Ingredients:</label>
                        </div>
                        <div class="col">
                            <IngredientList />
                        </div>
                    </div>
                    <button>submit</button>
                </EditForm>
            </div>
        </div>
    </div>
</div>

@code {
    // public LocationChecker locationChecker = new LocationChecker();


    // public class LocationChecker
    // {
    //     public bool IsAtSVI { get; set; }
    //     public bool IsAtSVC { get; set; }
    //     public bool IsAtCS { get; set; }
    // }

    // [SupplyParameterFromForm]
    // public MenuItem newMenuItem { get; set; } = new MenuItem();

    //Might be messing up how a form binds to a model by doing this

    public bool IsAtSVI { get; set; }
    public bool IsAtSVC { get; set; }
    public bool IsAtCS { get; set; }

    [SupplyParameterFromForm]
    public MenuItem newMenuItem { get; set; } = new MenuItem();

    [SupplyParameterFromForm]
    public LocationMenu newLocationMenu { get; set; } = new LocationMenu();

    public void OnPost()
    {

        Context.MenuItems.Add(newMenuItem);
        Context.SaveChanges();

        if (IsAtSVI)
        {
            newLocationMenu.LocationID = 1;
            newLocationMenu.MenuItemID = newMenuItem.MenuItemID;
            // newLocationMenu.MenuItemID = Context.MenuItems.Max(a => a.MenuItemID);
            Context.LocationMenus.Add(newLocationMenu);
            Context.SaveChanges();
        }

        if (IsAtSVC)
        {
            newLocationMenu.LocationID = 2;
            newLocationMenu.MenuItemID = newMenuItem.MenuItemID;
            Context.LocationMenus.Add(newLocationMenu);
            Context.SaveChanges();
        }

        if (IsAtCS)
        {
            newLocationMenu.LocationID = 3;
            newLocationMenu.MenuItemID = newMenuItem.MenuItemID;
            Context.LocationMenus.Add(newLocationMenu);
            Context.SaveChanges();
        }
        

    }


}